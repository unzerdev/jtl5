!function(e,t,r,n){function i(t,n,i){this.settings=i||{};var s={locale:this.settings.locale||"de-DE"};this.unzerInstance=new unzer(t,s),this.customerId=i.customerId||null,this.customerResource=null,this.paymentType=this.initPaymentType(n),this.$errorContainer=this.settings.$errorContainer||e("#error-container"),this.$errorMessage=this.settings.$errorMessage||this.$errorContainer.find(".alert"),this.form=this.settings.form||r.getElementById("form_payment_extra"),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.form.addEventListener("submit",this.handleFormSubmit),this.settings.autoSubmit&&this.handleFormSubmit(new Event("submit"))}i.PAYMENT_TYPES={ALIPAY:"Alipay",CARD:"Card",EPS:"EPS",FLEXIPAY_DIRECT:"FlexiPay Direct",HIRE_PURCHASE:"Hire Purchase",PAYPAL:"Paypal",INVOICE:"Invoice",INVOICE_FACTORING:"Invoice Factoring",INVOICE_GUARANTEED:"Invoice Guaranteed",SEPA:"SEPA",SEPA_GUARANTEED:"SEPA (guaranteed)",SOFORT:"SOFORT",GIROPAY:"Giropay",PRZELEWY24:"Przelewy24",IDEAL:"iDEAL",PREPAYMENT:"Prepayment",WECHAT_PAY:"WeChat Pay"},i.prototype.initPaymentType=function(e){switch(e){case i.PAYMENT_TYPES.CARD:return this.createCard();case i.PAYMENT_TYPES.INVOICE:return this.createInvoice();case i.PAYMENT_TYPES.INVOICE_GUARANTEED:return this.createInvoiceGuaranteed();case i.PAYMENT_TYPES.INVOICE_FACTORING:return this.createInvoiceFactoring();case i.PAYMENT_TYPES.SEPA:return this.createSepa();case i.PAYMENT_TYPES.SEPA_GUARANTEED:return this.createSepaGuaranteed();case i.PAYMENT_TYPES.PAYPAL:return this.createPaypal();case i.PAYMENT_TYPES.SOFORT:return this.createSofort();case i.PAYMENT_TYPES.GIROPAY:return this.createGiropay();case i.PAYMENT_TYPES.PRZELEWY24:return this.createPrzelewy24();case i.PAYMENT_TYPES.IDEAL:return this.createIdeal();case i.PAYMENT_TYPES.PREPAYMENT:return this.createPrepayment();case i.PAYMENT_TYPES.EPS:return this.createEPS();case i.PAYMENT_TYPES.FLEXIPAY_DIRECT:return this.createFlexiPayDirect();case i.PAYMENT_TYPES.ALIPAY:return this.createAlipay();case i.PAYMENT_TYPES.WECHAT_PAY:return this.createWeChatPay();case i.PAYMENT_TYPES.HIRE_PURCHASE:return this.createHirePurchase();default:throw new Error("Unkown Payment Type: "+e)}},i.prototype.handleFormSubmit=function(e){var t=this;e.preventDefault();var n=[this.paymentType.createResource()];this.customerResource&&n.push(this.customerId?this.customerResource.updateCustomer():this.customerResource.createCustomer()),Promise.all(n).then(function(e){var n=r.createElement("input");if(n.setAttribute("type","hidden"),n.setAttribute("name","paymentData[resourceId]"),n.setAttribute("value",e[0].id),t.form.appendChild(n),e.length>=2){var i=r.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","paymentData[customerId]"),i.setAttribute("value",e[1].id),t.form.appendChild(i)}t.form.removeEventListener("submit",t.handleFormSubmit),t.form.submit()}).catch(function(e){t.$errorContainer.show(),t.$errorMessage.html(e.message)})},i.prototype.createCustomer=function(){var e=this.settings.isB2B?this.unzerInstance.B2BCustomer():this.unzerInstance.Customer(),t=this.settings.customer||{},n=this.settings.submitButton||r.getElementById("submit-button");if(this.settings.isB2B,e.initFormFields(t),e.addEventListener("validate",function(e){e.success?n.removeAttribute("disabled"):n.setAttribute("disabled",!0)}),this.customerId){var i={containerId:"customer",fields:["birthdate"],showInfoBox:!1,showHeader:!1};return this.settings.isB2B&&(i={containerId:"customer"}),e.update(this.customerId,i),e}return e.create({containerId:"customer",showInfoBox:!1,showHeader:!1}),e},i.prototype.createCard=function(){var e=this.unzerInstance.Card(),t={fontSize:null,fontColor:null,fontFamily:null};this.settings.styling&&(t.fontColor=this.settings.styling.fontColor||null,t.fontSize=this.settings.styling.fontSize||null,t.fontFamily=this.settings.styling.fontFamily||null),e.create("number",{containerId:"card-element-id-number",onlyIframe:!1,fontSize:t.fontSize,fontColor:t.fontColor,fontFamily:t.fontFamily}),e.create("expiry",{containerId:"card-element-id-expiry",onlyIframe:!1,fontSize:t.fontSize,fontColor:t.fontColor,fontFamily:t.fontFamily}),e.create("cvc",{containerId:"card-element-id-cvc",onlyIframe:!1,fontSize:t.fontSize,fontColor:t.fontColor});var n=this,i={},s=n.settings.submitButton||r.getElementById("submit-button");s.setAttribute("disabled",!0);return e.addEventListener("change",function(e){e.success&&(i[e.type]=!0,n.$errorContainer.hide(),n.$errorMessage.html()),e.error&&(i[e.type]=!1,n.$errorContainer.show(),n.$errorMessage.html(e.error)),i.number&&i.expiry&&i.cvc?s.removeAttribute("disabled"):s.setAttribute("disabled",!0)}),e},i.prototype.createInvoice=function(){return this.unzerInstance.Invoice()},i.prototype.createInvoiceGuaranteed=function(){return this.customerResource=this.createCustomer(),this.unzerInstance.InvoiceSecured()},i.prototype.createInvoiceFactoring=function(){return this.customerResource=this.createCustomer(),this.unzerInstance.InvoiceSecured()},i.prototype.createSepa=function(){var e=this.unzerInstance.SepaDirectDebit();return e.create("sepa-direct-debit",{containerId:"sepa-IBAN"}),e},i.prototype.createSepaGuaranteed=function(){var e=this.unzerInstance.SepaDirectDebitSecured();return e.create("sepa-direct-debit-guaranteed",{containerId:"sepa-guaranteed-IBAN"}),this.customerResource=this.createCustomer(),e},i.prototype.createPaypal=function(){var e=this.unzerInstance.Paypal();return e.create("email",{containerId:"paypal-element-email"}),e},i.prototype.createSofort=function(){return this.unzerInstance.Sofort()},i.prototype.createGiropay=function(){return this.unzerInstance.Giropay()},i.prototype.createPrzelewy24=function(){return this.unzerInstance.Przelewy24()},i.prototype.createIdeal=function(){var e=this.unzerInstance.Ideal();return e.create("ideal",{containerId:"ideal-element"}),e},i.prototype.createPrepayment=function(){return this.unzerInstance.Prepayment()},i.prototype.createEPS=function(){var e=this.unzerInstance.EPS();return e.create("eps",{containerId:"eps-element"}),e},i.prototype.createFlexiPayDirect=function(){return this.unzerInstance.FlexiPayDirect()},i.prototype.createAlipay=function(){return this.unzerInstance.Alipay()},i.prototype.createWeChatPay=function(){return this.unzerInstance.Wechatpay()},i.prototype.createHirePurchase=function(){var e=this.unzerInstance.InstallmentSecured(),t=this;this.customerResource=this.createCustomer();var n=t.settings.submitButton||r.getElementById("submit-button");return n.setAttribute("style","display: none"),n.setAttribute("disabled",!0),e.create({containerId:"hire-purchase-element",amount:this.settings.amount||null,currency:this.settings.currency||null,effectiveInterest:this.settings.effectiveInterest||null,orderDate:this.settings.orderDate||null}).then(function(e){}).catch(function(e){var r="";console.error(e.message),e.error.details.forEach(function(e){console.error("API-Error: "+e.code),r+=e.customerMessage}),t.$errorContainer.show(),t.$errorMessage.html(r)}),e.addEventListener("installmentSecuredEvent",function(e){if("validate"===e.action){if(e.success)return void n.removeAttribute("disabled");n.setAttribute("disabled",!0)}if("change-step"===e.action){if("plan-list"===e.currentSteep)return n.setAttribute("style","display: none"),void n.setAttribute("disabled",!0);n.setAttribute("style","display: inline-block")}}),e},t.HpPayment=i,t.HpInstalment=function(t,r,n){var i=e(t);r.addEventListener("click",function(){n.trigger("submit")}),n.on("submit",function(e){return!!i.is(":visible")||(e.preventDefault(),i.modal("show"),!1)})}}(jQuery,window,window.document);